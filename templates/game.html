<!DOCTYPE html>
<html lang="en">

<head>
	<title>Game</title>
	{% load static %}
	<link rel="stylesheet" href="{% static 'game.css' %}">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
	<h1>Game ID: {{game.uuid}}</h1>
	<div class="info">
		<h2>Player A</h2>
		<h2>Player B</h2>
	</div>

	{% if game.userRole == "A" %}
		<div class="info">
			<p>{{user}}</p>
			<p>{{game.agent.agentType}}</p>
		</div>
		<div class='moves'>
			<div class="user">
				<p class="left" id="userMove"></p>
				<form
					type="range"
					id="djangoForm"
					method="POST"
					updateURL="{% url 'updateGame' %}">
						{% csrf_token %} 
						{{form.as_p}}
				</form>
			</div>
			<div class="send">
				<input class="send" type="submit" id="submitButton" form="djangoForm" value="send 0">
			</div>
			<div class='agent'>
				<p class="right" id="agentMove"></p>
			</div>
		</div>
		<div class="info">
			<p id="userMoves"></p>
			<p id="agentMoves"></p>
		</div>

	{% else %}
		<div class="info">
			<p>{{game.agent.agentType}}</p>
			<p>{{user}}</p>
		</div>
		<div class='moves'>
			<div class='agent'>
				<p class="left" id="agentMove"></p>
			</div>
			<div class="send">
				<input class="send" type="submit" id="submitButton" form="djangoForm" value="send 0"/>
			</div>
			<div class="user">
				<form type="range" id="djangoForm" method="POST">
					{% csrf_token %}
					<input type="hidden" name="gameID" value="{{game.id}}" />
					{{form.as_p}}
				</form>
				<p class="right" id="userMove"></p>
			</div>
		</div>
		<div class="info">
			<p id="agentMoves"></p>
			<p id="userMoves"></p>
		</div>		
	{% endif %}

	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<!-- <script src="{% static 'game.js' %}"></script> -->
	<script type="text/javascript">
		// Update text of "send" button to reflect value of slider
		$("#djangoForm").change(function moveSlider() {
			$("#submitButton").val("send "+$("#id_userMove").val());
		});

		// Update models and DOM when "send" button is pressed
		$("#submitButton").click(function callUpdate() {
			"use strict";
			console.log("ajax initiate");
			let form = $("#djangoForm");
			$.ajax({
				method: 'POST',
				url: form.attr("updateURL"),
				data: form.serialize(),
				dataType: 'json',
				success: function (data) {
					console.log("hello");
					$("#userMove").text(data.userMove);
					$("#agentMove").text(data.agentMove);
					$("#userMoves").text(data.userMoves);
					$("#agentMoves").text(data.agentMoves);
					// $("#userMove").text(data.userMove);
					// $("#agentMove").text(data.agentMoves);
					// $("#userMoves").text(data.userMoves);
					// $("#agentMoves").text(data.agentMoves);
					// console.log("{{game.userMove}}");
				}
			});
			return false;
		});
	</script>
</body>
</html>
